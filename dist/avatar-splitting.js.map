{"version":3,"file":"avatar-splitting.js","sources":["../src/index.js"],"sourcesContent":["export default function avatar(options) {\n    let image = options.image;\n    let maskImage = options.maskImage;\n    let vertical = false;\n    if (!image) {\n        console.error('Image cannot be empty!');\n        return;\n    } else if (typeof image != 'string') {\n        console.error('Image must be a string type!');\n        return;\n    }\n    if (maskImage != '' && typeof maskImage != 'undefined') {\n        if (typeof maskImage != 'string') {\n            console.error('maskImage must be a string type!');\n            return;\n        } else {\n            vertical = true;\n        }\n    } else {\n        vertical = false;\n    }\n    let option = extend({\n        exportType : 'base64',\n        success(){},\n        error(){},\n    }, options);\n    let maskImg = new Image;\n    maskImg.crossOrigin = '*';\n\n    maskImg.onload = function () {\n        let maskCanvas = document.createElement('canvas'),\n            maskCtx = maskCanvas.getContext('2d');\n        maskCanvas.width = maskImg.width;\n        maskCanvas.height = `${vertical ? maskImg.height  : maskImg.height / 2} `;\n        maskCtx.drawImage(maskImg, 0, `${vertical ? 0 : maskCanvas.height}`, maskImg.width, maskCanvas.height, 0, 0, maskImg.width, maskCanvas.height);\n        let maskImageData = maskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\n\n        let originImg = new Image;\n        originImg.crossOrigin = '*';\n\n        originImg.onload = function () {\n            let originCanvas = document.createElement('canvas'),\n                originCtx = originCanvas.getContext('2d');\n            originCanvas.width = `${vertical ? maskImg.width : originImg.width}`;\n            originCanvas.height = `${vertical ? maskCanvas.height : originImg.height/2}`;\n            originCtx.drawImage(originImg, 0, 0,originImg.width, `${vertical ? originImg.height : originImg.height / 2}`, 0, 0, `${vertical ? maskImg.width : originImg.width}`, `${vertical ? maskImg.height : originImg.height / 2}`);\n            let originImgData = originCtx.getImageData(0, 0, originCanvas.width, originCanvas.height),\n                resultBase64 = get_alpha_image(originImgData, maskImageData, option);\n            option.success(resultBase64);\n        };\n\n        originImg.src = image + '?' + new Date().getTime();\n\n        originImg.onerror = () => {\n            option.error({code:0,msg:'load image error'});\n        };\n    };\n\n    maskImg.src = `${vertical ? maskImage : image}` + '?' + new Date().getTime();\n\n    maskImg.onerror = () => {\n        option.error({code:0,msg:'load image error'});\n    };\n}\n\nfunction extend(opt1, opt2) {\n    for (let i in opt2) {\n        if (opt2.hasOwnProperty(i)) {\n            if (typeof opt2[i] == 'object') {\n                if (typeof opt1[i] !== 'object' || opt1[i] === null) {\n                    opt1[i] = {};\n                }\n                extend(opt1[i], opt2[i]);\n            } else {\n                opt1[i] = opt2[i];\n            }\n        }\n    }\n    return opt1;\n}\n\nfunction get_alpha_image(srcImage, maskImage, option) {\n    let canvas = document.createElement('canvas'),\n        result = canvas.getContext('2d').createImageData(srcImage);\n    let size = srcImage.width * srcImage.height * 4,\n        MT_RED = 0,\n        MT_GREEN = 1,\n        MT_BLUE = 2,\n        MT_ALPHA = 3;\n\n    for (var i = 0; i < size; i += 4) {\n        result.data[i + MT_RED] = srcImage.data[MT_RED + i];\n        result.data[i + MT_GREEN] = srcImage.data[MT_GREEN + i];\n        result.data[i + MT_BLUE] = srcImage.data[MT_BLUE + i];\n        result.data[i + MT_ALPHA] = maskImage.data[i];\n    }\n\n    let resultCanvas = document.createElement('canvas'),\n        resultCtx = resultCanvas.getContext('2d');\n    resultCanvas.width = result.width;\n    resultCanvas.height = result.height;\n    resultCtx.putImageData(result, 0, 0, 0, 0, resultCanvas.width, resultCanvas.height);\n\n    if (option.exportType == 'canvas') {\n        return resultCanvas;\n    } else {\n        return resultCanvas.toDataURL('image/png');\n    }\n}"],"names":["avatar","options","image","maskImage","vertical","console","error","option","extend","exportType","success","maskImg","Image","crossOrigin","onload","maskCanvas","document","createElement","maskCtx","getContext","width","height","drawImage","maskImageData","getImageData","originImg","originCanvas","originCtx","originImgData","resultBase64","get_alpha_image","src","Date","getTime","onerror","code","msg","opt1","opt2","i","hasOwnProperty","srcImage","canvas","result","createImageData","size","MT_RED","MT_GREEN","MT_BLUE","MT_ALPHA","data","resultCanvas","resultCtx","putImageData","toDataURL"],"mappings":";;;;;;;;AAAA,IAAe,SAASA,MAAT,CAAgBC,OAAhB,EAAyB;IACpC,QAAIC,QAAQD,QAAQC,KAApB;IACA,QAAIC,YAAYF,QAAQE,SAAxB;IACA,QAAIC,WAAW,KAAf;IACA,QAAI,CAACF,KAAL,EAAY;IACRG,gBAAQC,KAAR,CAAc,wBAAd;IACA;IACH,KAHD,MAGO,IAAI,OAAOJ,KAAP,IAAgB,QAApB,EAA8B;IACjCG,gBAAQC,KAAR,CAAc,8BAAd;IACA;IACH;IACD,QAAIH,aAAa,EAAb,IAAmB,OAAOA,SAAP,IAAoB,WAA3C,EAAwD;IACpD,YAAI,OAAOA,SAAP,IAAoB,QAAxB,EAAkC;IAC9BE,oBAAQC,KAAR,CAAc,kCAAd;IACA;IACH,SAHD,MAGO;IACHF,uBAAW,IAAX;IACH;IACJ,KAPD,MAOO;IACHA,mBAAW,KAAX;IACH;IACD,QAAIG,SAASC,OAAO;IAChBC,oBAAa,QADG;IAEhBC,eAFgB,qBAEP,EAFO;IAGhBJ,aAHgB,mBAGT;IAHS,KAAP,EAIVL,OAJU,CAAb;IAKA,QAAIU,UAAU,IAAIC,KAAJ,EAAd;IACAD,YAAQE,WAAR,GAAsB,GAAtB;;IAEAF,YAAQG,MAAR,GAAiB,YAAY;IACzB,YAAIC,aAAaC,SAASC,aAAT,CAAuB,QAAvB,CAAjB;IAAA,YACIC,UAAUH,WAAWI,UAAX,CAAsB,IAAtB,CADd;IAEAJ,mBAAWK,KAAX,GAAmBT,QAAQS,KAA3B;IACAL,mBAAWM,MAAX,IAAuBjB,WAAWO,QAAQU,MAAnB,GAA6BV,QAAQU,MAAR,GAAiB,CAArE;IACAH,gBAAQI,SAAR,CAAkBX,OAAlB,EAA2B,CAA3B,QAAiCP,WAAW,CAAX,GAAeW,WAAWM,MAA3D,GAAqEV,QAAQS,KAA7E,EAAoFL,WAAWM,MAA/F,EAAuG,CAAvG,EAA0G,CAA1G,EAA6GV,QAAQS,KAArH,EAA4HL,WAAWM,MAAvI;IACA,YAAIE,gBAAgBL,QAAQM,YAAR,CAAqB,CAArB,EAAwB,CAAxB,EAA2BT,WAAWK,KAAtC,EAA6CL,WAAWM,MAAxD,CAApB;;IAEA,YAAII,YAAY,IAAIb,KAAJ,EAAhB;IACAa,kBAAUZ,WAAV,GAAwB,GAAxB;;IAEAY,kBAAUX,MAAV,GAAmB,YAAY;IAC3B,gBAAIY,eAAeV,SAASC,aAAT,CAAuB,QAAvB,CAAnB;IAAA,gBACIU,YAAYD,aAAaP,UAAb,CAAwB,IAAxB,CADhB;IAEAO,yBAAaN,KAAb,SAAwBhB,WAAWO,QAAQS,KAAnB,GAA2BK,UAAUL,KAA7D;IACAM,yBAAaL,MAAb,SAAyBjB,WAAWW,WAAWM,MAAtB,GAA+BI,UAAUJ,MAAV,GAAiB,CAAzE;IACAM,sBAAUL,SAAV,CAAoBG,SAApB,EAA+B,CAA/B,EAAkC,CAAlC,EAAoCA,UAAUL,KAA9C,QAAwDhB,WAAWqB,UAAUJ,MAArB,GAA8BI,UAAUJ,MAAV,GAAmB,CAAzG,GAA8G,CAA9G,EAAiH,CAAjH,QAAuHjB,WAAWO,QAAQS,KAAnB,GAA2BK,UAAUL,KAA5J,SAAwKhB,WAAWO,QAAQU,MAAnB,GAA4BI,UAAUJ,MAAV,GAAmB,CAAvN;IACA,gBAAIO,gBAAgBD,UAAUH,YAAV,CAAuB,CAAvB,EAA0B,CAA1B,EAA6BE,aAAaN,KAA1C,EAAiDM,aAAaL,MAA9D,CAApB;IAAA,gBACIQ,eAAeC,gBAAgBF,aAAhB,EAA+BL,aAA/B,EAA8ChB,MAA9C,CADnB;IAEAA,mBAAOG,OAAP,CAAemB,YAAf;IACH,SATD;;IAWAJ,kBAAUM,GAAV,GAAgB7B,QAAQ,GAAR,GAAc,IAAI8B,IAAJ,GAAWC,OAAX,EAA9B;;IAEAR,kBAAUS,OAAV,GAAoB,YAAM;IACtB3B,mBAAOD,KAAP,CAAa,EAAC6B,MAAK,CAAN,EAAQC,KAAI,kBAAZ,EAAb;IACH,SAFD;IAGH,KA3BD;;IA6BAzB,YAAQoB,GAAR,GAAc,MAAG3B,WAAWD,SAAX,GAAuBD,KAA1B,IAAoC,GAApC,GAA0C,IAAI8B,IAAJ,GAAWC,OAAX,EAAxD;;IAEAtB,YAAQuB,OAAR,GAAkB,YAAM;IACpB3B,eAAOD,KAAP,CAAa,EAAC6B,MAAK,CAAN,EAAQC,KAAI,kBAAZ,EAAb;IACH,KAFD;IAGH;;IAED,SAAS5B,MAAT,CAAgB6B,IAAhB,EAAsBC,IAAtB,EAA4B;IACxB,SAAK,IAAIC,CAAT,IAAcD,IAAd,EAAoB;IAChB,YAAIA,KAAKE,cAAL,CAAoBD,CAApB,CAAJ,EAA4B;IACxB,gBAAI,QAAOD,KAAKC,CAAL,CAAP,KAAkB,QAAtB,EAAgC;IAC5B,oBAAI,QAAOF,KAAKE,CAAL,CAAP,MAAmB,QAAnB,IAA+BF,KAAKE,CAAL,MAAY,IAA/C,EAAqD;IACjDF,yBAAKE,CAAL,IAAU,EAAV;IACH;IACD/B,uBAAO6B,KAAKE,CAAL,CAAP,EAAgBD,KAAKC,CAAL,CAAhB;IACH,aALD,MAKO;IACHF,qBAAKE,CAAL,IAAUD,KAAKC,CAAL,CAAV;IACH;IACJ;IACJ;IACD,WAAOF,IAAP;IACH;;IAED,SAASP,eAAT,CAAyBW,QAAzB,EAAmCtC,SAAnC,EAA8CI,MAA9C,EAAsD;IAClD,QAAImC,SAAS1B,SAASC,aAAT,CAAuB,QAAvB,CAAb;IAAA,QACI0B,SAASD,OAAOvB,UAAP,CAAkB,IAAlB,EAAwByB,eAAxB,CAAwCH,QAAxC,CADb;IAEA,QAAII,OAAOJ,SAASrB,KAAT,GAAiBqB,SAASpB,MAA1B,GAAmC,CAA9C;IAAA,QACIyB,SAAS,CADb;IAAA,QAEIC,WAAW,CAFf;IAAA,QAGIC,UAAU,CAHd;IAAA,QAIIC,WAAW,CAJf;;IAMA,SAAK,IAAIV,IAAI,CAAb,EAAgBA,IAAIM,IAApB,EAA0BN,KAAK,CAA/B,EAAkC;IAC9BI,eAAOO,IAAP,CAAYX,IAAIO,MAAhB,IAA0BL,SAASS,IAAT,CAAcJ,SAASP,CAAvB,CAA1B;IACAI,eAAOO,IAAP,CAAYX,IAAIQ,QAAhB,IAA4BN,SAASS,IAAT,CAAcH,WAAWR,CAAzB,CAA5B;IACAI,eAAOO,IAAP,CAAYX,IAAIS,OAAhB,IAA2BP,SAASS,IAAT,CAAcF,UAAUT,CAAxB,CAA3B;IACAI,eAAOO,IAAP,CAAYX,IAAIU,QAAhB,IAA4B9C,UAAU+C,IAAV,CAAeX,CAAf,CAA5B;IACH;;IAED,QAAIY,eAAenC,SAASC,aAAT,CAAuB,QAAvB,CAAnB;IAAA,QACImC,YAAYD,aAAahC,UAAb,CAAwB,IAAxB,CADhB;IAEAgC,iBAAa/B,KAAb,GAAqBuB,OAAOvB,KAA5B;IACA+B,iBAAa9B,MAAb,GAAsBsB,OAAOtB,MAA7B;IACA+B,cAAUC,YAAV,CAAuBV,MAAvB,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,CAArC,EAAwC,CAAxC,EAA2CQ,aAAa/B,KAAxD,EAA+D+B,aAAa9B,MAA5E;;IAEA,QAAId,OAAOE,UAAP,IAAqB,QAAzB,EAAmC;IAC/B,eAAO0C,YAAP;IACH,KAFD,MAEO;IACH,eAAOA,aAAaG,SAAb,CAAuB,WAAvB,CAAP;IACH;IACJ;;;;;;;;;;;;"}